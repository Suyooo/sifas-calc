<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>SIFAS Notemap/Song Database</title>
    <meta name="description"
          content="A list of songs in SIFAS, including a complete note map reader, gimmick note timings and AC rewards.">

    <link type="text/css" rel="stylesheet" href="vendor/materialize.css" media="screen,projection"/>
    <link type="text/css" rel="stylesheet" href="css/style.css" media="screen,projection"/>
    <link type="text/css" rel="stylesheet" href="css/songdb.css" media="screen,projection"/>

    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <link rel="icon" type="image/png" sizes="96x96" href="image/launcher-icon-96.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="#f48fb1">
    <meta name="theme-color" content="#f48fb1">
</head>
<body>
<script>
    if (document.cookie.indexOf("dark-mode=yes") !== -1) {
        document.body.className += 'dark-mode';
    }
</script>
<div class="font-preload">
    <span style="font-weight: 100">Thin</span>
    <span style="font-weight: 300">Light</span>
    <span style="font-weight: 400">Regular</span>
    <span style="font-weight: 500">Medium</span>
    <span style="font-weight: 700">Bold</span>
</div>
<nav>
    <div class="nav-wrapper orange lighten-5">
        <a class="brand-logo center">Notemap DB</a>
        <ul id="nav-mobile" class="left">
            <li class="orange lighten-3"><a href="index.html"><i
                    class="material-icons left">keyboard_arrow_left</i>BACK</a></li>
        </ul>
    </div>
</nav>
<center><a href="tower.html" style="font-size: 200%">View DLP Stage List &gt;&gt;&gt;</a></center>
<div class="container">$SONGDB</div>
<div class="tooltip">
    <div class="tooltip-inner"></div>
    <div class="tooltip-arrow">&#9662;</div>
</div>
<script type="text/javascript" src="js/register-sw.js"></script>
<script type="text/javascript" src="vendor/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="vendor/materialize.js"></script>
<script>$(function () {
    M.AutoInit();
    let tooltip = $(".tooltip");
    let tooltipInner = $(".tooltip-inner");
    let body = $("body");

    // materialize doesn't set indicator positions inside hidden elements, so we'll do it ourselves on open
    $(".collapsible").each(function () {
        M.Collapsible.getInstance(this).options.onOpenStart = function () {
            let tabs = $(".tabs", this.el);
            let activetab = $(".active", tabs).parent();
            let alltabs = activetab.parent().children();
            let tabindex = alltabs.index(activetab);
            let tabwidth = 100 / (alltabs.length - 1);
            $(".indicator", tabs).css("left", (tabwidth * tabindex) + "%")
                .css("right", (tabwidth * (-tabindex + alltabs.length - 2)) + "%");
        }

        $(".live-difficulty", this).each(function () {
            let selecting = false;
            // note measure
            // TODO: add support for touch events on mobile... how?
            let notebar = $(".notebar", this);
            notebar.mousedown(function (e) {
                selecting = true;
                let selector = $("<div></div>").addClass("selection");
                notebar.append(selector);
                let fixedStartpos = e.pageX;
                let notebarPos = notebar.offset();
                let notebarWidth = notebar.width();
                body.mousemove(function (e) {
                    let startpos = fixedStartpos;
                    let endpos = e.pageX;
                    if (endpos < startpos) {
                        let temp = startpos;
                        startpos = endpos;
                        endpos = temp;
                    }
                    if (startpos < notebarPos.left) {
                        startpos = notebarPos.left;
                    }
                    if (endpos > notebarPos.left + notebarWidth) {
                        endpos = notebarPos.left + notebarWidth;
                    }

                    let count = 0;
                    $(".note", notebar).each(function () {
                        let notepos = $(this).offset().left;
                        if (notepos >= startpos && notepos <= endpos) count++;
                    });

                    tooltipInner.text(count + " note" + (count !== 1 ? "s" : ""));
                    tooltip.css({"left": (startpos + endpos) / 2, "top": notebarPos.top});
                    selector.css({"left": startpos - notebarPos.left, "width": endpos - startpos});
                });
                body.mouseup(function () {
                    $(this).off("mousemove").off("mouseup");
                    selecting = false;
                    selector.remove();
                    tooltip.css({"left": 0, "top": 0});
                });
            });

            // gimmick mouseover
            let gimmickmarkers = $(".notebar .gimmick", this);
            let gimmickinfos = $(".detailinfo .gimmick", this);
            gimmickmarkers.mouseover(function () {
                if (selecting || $(this).hasClass("hidden")) return;
                let gi = $(this).data("gimmick");
                gimmickinfos.each(function () {
                    if ($(this).data("gimmick") === gi) {
                        let details = $("div", this);
                        tooltipInner.html("<b>" + details[0].innerHTML + "</b><br>" + details[1].innerHTML);
                        return false;
                    }
                });
                let thismarker = $(".gimmickmarker", this);
                let position = thismarker.offset();
                position.left += thismarker.width() / 2;
                tooltip.css(position);
            });
            gimmickmarkers.mouseout(function () {
                tooltip.css({"left": 0, "top": 0});
            });

            // appeal chance mouseover
            let acmarkers = $(".notebar .appealchance", this);
            let acinfos = $(".detailinfo .appealchance", this);
            acmarkers.mouseover(function () {
                if (selecting) return;
                let ai = $(this).data("ac");
                acinfos.each(function () {
                    if ($(this).data("ac") === ai) {
                        let details = $("div", this);
                        tooltipInner.html("<b>" + details[0].innerHTML + "</b><br>" + details[1].innerHTML);
                        return false;
                    }
                });
                let position = $(this).offset();
                position.left += $(this).width() / 2;
                tooltip.css(position);
            });
            acmarkers.mouseout(function () {
                tooltip.css({"left": 0, "top": 0});
            });

            // gimmick filtering
            gimmickinfos.click(function () {
                if ($(this).hasClass("filtered")) {
                    $(this).removeClass("filtered");
                    gimmickmarkers.removeClass("hidden filtered");
                } else {
                    gimmickinfos.removeClass("filtered");
                    $(this).addClass("filtered");
                    let gi = $(this).data("gimmick");
                    gimmickmarkers.each(function () {
                        if ($(this).data("gimmick") === gi) {
                            $(this).removeClass("hidden");
                            $(this).addClass("filtered");
                        } else {
                            $(this).removeClass("filtered");
                            $(this).addClass("hidden");
                        }
                    });
                }
            });
        });
    });
});</script>
</body>
</html>